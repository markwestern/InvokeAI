<html lang="en">

<head>
  <title>Stable Diffusion Dream Server</title>
  <meta charset="utf-8">
  <link rel="icon" type="image/x-icon" href="static/dream_web/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">

  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/css/bootstrap-night.min.css" rel="stylesheet">
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />

  <link rel="stylesheet" href="static/dream_web/dream.css"
    type="text/css">

  <script src="config.js"></script>
  <script src="static/dream_web/index.js"></script>
</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

  <header>
    <h1>/diffuse-fork</h1>
    <div id="about">Stable Diffusion Dream Server</a>
    </div>
  </header>

  <main>
    <div class="container px-2">
      <div class="row gx-2">
        <form id="generate-form" method="post" action="#">

          <!-- -----PROMPT----- -->
          <fieldset id="txt2img">
            <div class="col">
              <div class="input-group">
                <textarea class="form-control" rows="3" id="prompt" name="prompt"></textarea>
                <button class="btn btn-primary" type="submit">
                  <i class="fa fa-picture-o fa-lg"></i> Generate
                </button>
                <button class="btn btn-secondary" type="button" id="reset-all">
                  <i class="fa fa-ban fa-lg"></i> Reset</button>
              </div>
            </div>
          </fieldset>

          <!-- -----CONFIG----- -->
          <fieldset id="fieldset-config">

            <div class="row">
              <div class="col">
                <label class="row-form-label" for="iterations">Iterations:</label>
                <input class="form-control" value="1" type="number" id="iterations" name="iterations" size="4">
              </div>


              <div class="col">
                <label class="row-form-label" for="steps">Steps:</label>
                <input class="form-control" value="50" type="number" id="steps" name="steps">
              </div>


              <div class="col">
                <label class="row-form-label" for="cfg_scale">Guidance:</label>
                <input class="form-control" value="7.5" type="number" id="cfg_scale" name="cfg_scale" step="any">
              </div>


              <div class="col">
                <label class="row-form-label" for="sampler_name">Sampler:</label>
                <select class="form-select" id="sampler_name" name="sampler_name" value="k_lms">
                  <option value="ddim">DDIM</option>
                  <option value="plms">PLMS</option>
                  <option value="k_lms" selected>KLMS</option>
                  <option value="k_dpm_2">KDPM_2</option>
                  <option value="k_dpm_2_a">KDPM_2A</option>
                  <option value="k_euler">KEULER</option>
                  <option value="k_euler_a">KEULER_A</option>
                  <option value="k_heun">KHEUN</option>
                </select>
              </div>

              <div class="w-100"></div>

              <div class="col">
                <label class="row-form-label" title="Set to multiple of 64" for="height">Height:</label>
                <select class="form-select" id="height" name="height" value="512">
                  <option value="64">64</option>
                  <option value="128">128</option>
                  <option value="192">192</option>
                  <option value="256">256</option>
                  <option value="320">320</option>
                  <option value="384">384</option>
                  <option value="448">448</option>
                  <option value="512" selected>512</option>
                  <option value="576">576</option>
                  <option value="640">640</option>
                  <option value="704">704</option>
                  <option value="768">768</option>
                  <option value="832">832</option>
                  <option value="896">896</option>
                  <option value="960">960</option>
                  <option value="1024">1024</option>
                </select>
              </div>
              <div class="col">
                <label class="row-form-label" title="Set to multiple of 64" for="width">Width:</label>
                <select class="form-select" id="width" name="width" value="512">
                  <option value="64">64</option>
                  <option value="128">128</option>
                  <option value="192">192</option>
                  <option value="256">256</option>
                  <option value="320">320</option>
                  <option value="384">384</option>
                  <option value="448">448</option>
                  <option value="512" selected>512</option>
                  <option value="576">576</option>
                  <option value="640">640</option>
                  <option value="704">704</option>
                  <option value="768">768</option>
                  <option value="832">832</option>
                  <option value="896">896</option>
                  <option value="960">960</option>
                  <option value="1024">1024</option>
                </select>
              </div>

              <div class="col-6 g-lg-3">
                <div id="checkbox-group">
                  <div class="input-group">
                    <input class="form-check-input" type="checkbox" name="seamless" id="seamless">
                    <label class="form-check-label" for="seamless">&nbsp;Seamless tiling</label>
                  </div>
                  <div class="input-group">
                    <input class="form-check-input" type="checkbox" name="progress_images" id="progress_images">
                    <label class="form-check-label" for="progress_images">&nbsp;Progress images</label>
                  </div>
                </div>
              </div>

              <div class="w-100"></div>


              <!-- -----VARIATIONS----- -->
              <div class="col">
                <label class="row-form-label" title="Set to -1 for random seed" for="seed">Seed:</label>
                <div class="input-group">
                  <input class="form-control" value="-1" type="number" id="seed" name="seed">
                  <button class="btn btn-primary" type="button" id="reset-seed">&olarr;</button>
                </div>
              </div>

              <div class="col">
                <label class="row-form-label"
                  title="If > 0, generates variations on the initial seed instead of random seeds per iteration. Must be between 0 and 1. Higher values will be more different."
                  for="variation_amount">Variation:</label>
                <input class="form-control" value="0" type="number" id="variation_amount" name="variation_amount"
                  step="0.01" min="0" max="1">
                <small class="form-text text-muted">(0 to disable)</small>
              </div>

              <div class="col">
                <label class="row-form-label"
                  title="list of variations to apply, in the format `seed:weight,seed:weight,..."
                  for="with_variations">With
                  variations:</label>
                <input class="form-control" value="" type="text" id="with_variations" name="with_variations">
                <small class="form-text text-muted">(seed:weight,seed:weight,...)</small>
              </div>


              <div class="w-100"></div>

              <!-- -----IMG2IMG----- -->

              <div class="col-8">
                <label class="row-form-label" title="Upload an image to use img2img" for="initimg">Initial
                  image:</label>
                <div class="input-group">
                  <input class="form-control" type="file" id="initimg" name="initimg" accept=".jpg, .jpeg, .png">
                  <button class="btn btn-primary" type="button" id="remove-image">Remove Image</button>
                </div>
              </div>

              <div class="col">
                <label class="row-form-label" for="strength">Img2Img Strength:</label>
                <input class="form-control" value="0.75" type="number" id="strength" name="strength" step="0.01"
                  min="0"
                  max="1">
              </div>
            </div>
          </fieldset>


          <!-- -----GFPGAN----- -->
          <fieldset id="gfpgan">
            <div class="row">
              <div class="col">
                <input class="form-check-input" type="checkbox" id="fit" name="fit">
                <label class="form-check-label" title="Rescale image to fit within requested width and height"
                  for="fit">Fit to width/height:</label>
              </div>

              <div class="col">
                <label class="row-form-label" title="Strength of the gfpgan (face fixing) algorithm."
                  for="gfpgan_strength">GPFGAN Strength (0 to disable):</label>
                <input class="form-control" value="0.8" min="0" max="1" type="number" id="gfpgan_strength"
                  name="gfpgan_strength" step="0.05">
              </div>

              <div class="col">
                <label class="row-form-label" title="Upscaling to perform using ESRGAN."
                  for="upscale_level">Upscaling&nbsp;Level</label>
                <select id="upscale_level" name="upscale_level" value="">
                  <option value="" selected>None</option>
                  <option value="2">2x</option>
                  <option value="4">4x</option>
                </select>
              </div>

              <div class="col">
                <label class="row-form-label" title="Strength of the esrgan (upscaling) algorithm."
                  for="upscale_strength">Upscale Strength:</label>
                <input value="0.75" min="0" max="1" type="number" id="upscale_strength" name="upscale_strength"
                  step="0.05">
              </div>
            </div>
          </fieldset>
        </form>
        <br>

        <!-- -----PROGRESS----- -->
        <div id="progress-section">
          <div class="row">
            <div class="col">
              <img id="progress-image" src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"/>'>
              <div class="progress" id="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
              </div>
              <div id="scaling-inprocess-message">
                <i><span>Postprocessing...</span><span id="processing_cnt">1/3</span></i>
              </div>
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary" type="button" id="cancel-button">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <!-- -----RESULTS----- -->
    <div class="row">
      <div id="results">
      </div>
    </div>
  </main>
  <img src="/static/dream_web/qr.PNG" />

  <script>
    Fancybox.bind('[data-fancybox="gallery"]', {
      dragToClose: false,

      Toolbar: false,
      closeButton: "top",

      Image: {
        zoom: false,
      },

      on: {
        initCarousel: (fancybox) => {
          const slide = fancybox.Carousel.slides[fancybox.Carousel.page];

          fancybox.$container.style.setProperty(
            "--bg-image",
            `url("${slide.$thumb.src}")`
          );
        },
        "Carousel.change": (fancybox, carousel, to, from) => {
          const slide = carousel.slides[to];

          fancybox.$container.style.setProperty(
            "--bg-image",
            `url("${slide.$thumb.src}")`
          );
        },
      },
    });
  </script>
</body>


</html>